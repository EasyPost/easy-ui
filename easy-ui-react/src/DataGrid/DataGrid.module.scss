/* stylelint-disable no-descending-specificity */
/* stylelint-disable scss/operator-no-newline-after */

@use "../styles/common" as *;
@use "../styles/unstyled";

.DataGrid {
  @include component-token(
    "data-grid",
    "header-bg",
    design-token("color.blue.800")
  );
  @include component-token(
    "data-grid",
    "header-text",
    design-token("color.white")
  );
  @include component-token("data-grid", "header-row-height", 48px);
  @include component-token("data-grid", "body-row-height", 56px);
  @include component-token("data-grid", "expand-btn-size", 24px);
  @include component-token(
    "data-grid",
    "sort-icon-color",
    design-token("color.gray.500")
  );
  @include component-token(
    "data-grid",
    "border-width",
    design-token("shape.border_width.1")
  );
  @include component-token(
    "data-grid",
    "border-color",
    design-token("color.gray.300")
  );
  @include component-token("data-grid", "sticky-shadow-size", 8px);
  @include component-token("data-grid", "sticky-shadow-opacity", 0.5);
  @include component-token(
    "data-grid",
    "sticky-shadow-color",
    design-token("color.gray.500")
  );
  @include component-token("data-grid", "cell-bg", design-token("color.white"));
  @include component-token(
    "data-grid",
    "cell-text",
    design-token("color.blue.800")
  );
  @include component-token("data-grid", "cell-z-index", 1);
  @include component-token("data-grid", "cell-stuck-z-index", 2);
  @include component-token("data-grid", "column-z-index", 3);
  @include component-token("data-grid", "column-stuck-z-index", 4);
  @include component-token("data-grid", "sticky-left-offset", -16px);
  @include component-token("data-grid", "sticky-right-offset", -12px);

  border: component-token("data-grid", "border-width") solid
    component-token("data-grid", "border-color");
  border-radius: design-token("shape.border_radius.md");
  overflow: auto;
  max-height: calc(
    (component-token("data-grid", "border-width") * 2) +
      (
        component-token("data-grid", "header-row-height") +
          (
            component-token("data-grid", "body-row-height") *
              component-token("data-grid", "max-rows")
          )
      )
  );
  position: relative;
}

.table {
  position: relative;
  min-width: min-content;
  display: grid;
  grid-template-rows: auto;
  grid-template-areas: component-token("data-grid", "template-areas");
  grid-template-columns: component-token("data-grid", "template-columns");
}

.columnHeader {
  @include font-style("subtitle2");

  position: sticky;
  top: 0;
  background: component-token("data-grid", "header-bg");
  color: component-token("data-grid", "header-text");
  height: component-token("data-grid", "header-row-height");
  z-index: component-token("data-grid", "column-z-index");
  outline: none;

  display: inline-flex;
  align-items: center;
  gap: design-token("space.1");
}

.columnHeaderAllowsSorting {
  user-select: none;
}

.sortIndicator {
  display: inline-flex;
  color: component-token("data-grid", "sort-icon-color");
}

.row {
  display: contents;
}

.cell {
  @include font-style("body1");
  background: component-token("data-grid", "cell-bg");
  color: component-token("data-grid", "cell-text");
  height: component-token("data-grid", "body-row-height");
  z-index: component-token("data-grid", "cell-z-index");
}

.headerUnderScroll .columnHeader {
  &::after,
  &::before {
    content: "";
    position: absolute;
    top: 100%;
    left: 0;
    width: 100%;
    height: component-token("data-grid", "sticky-shadow-size");
  }
  &::before {
    background-color: component-token("data-grid", "cell-bg");
  }
  &::after {
    background-image: linear-gradient(
      to bottom,
      component-token("data-grid", "sticky-shadow-color"),
      transparent
    );
    opacity: component-token("data-grid", "sticky-shadow-opacity");
  }
}

.columnHeaderFocused,
.cellFocused {
  @include native-focus-ring;
  outline-offset: -1px;
}

.columnHeader,
.cell {
  display: inline-flex;
  align-items: center;
  padding: 0 design-token("space.2");

  &:first-child {
    padding-left: design-token("space.5");
  }
  &:last-child {
    padding-right: design-token("space.5");
  }
}

.expandRowButton {
  @include unstyled.button;

  display: inline-flex;
  align-items: center;
  justify-content: center;

  width: component-token("data-grid", "expand-btn-size");
  height: component-token("data-grid", "expand-btn-size");
  margin: -4px;

  cursor: pointer;

  &.expanded {
    transform: rotate(90deg);
  }
}

.pendingExpandedRowContent,
.expandedRowContent {
  position: absolute;
  left: 0;
}

.expandedRowContent {
  top: component-token("data-grid", "expanded-row-position");
  width: component-token("data-grid", "expanded-row-width");
  opacity: component-token("data-grid", "expanded-row-opacity");
  padding: design-token("space.1") design-token("space.5");
}

.pendingExpandedRowContent {
  top: 0;
  opacity: 0;
  pointer-events: none;
  width: component-token("data-grid", "pending-expanded-row-width");
}

.rowExpanded .cell {
  margin-bottom: component-token("data-grid", "expanded-row-height");
}

.hasRowActions {
  .columnHeader,
  .cell {
    &:last-child {
      padding-left: design-token("space.0.5");
      padding-right: design-token("space.2");
      position: sticky;
      right: component-token("data-grid", "sticky-right-offset");
      z-index: component-token("data-grid", "cell-stuck-z-index");
    }
    &:nth-last-child(2) {
      padding-right: design-token("space.1.5");
    }
  }
  .columnHeader:last-child {
    z-index: component-token("data-grid", "column-stuck-z-index");
  }
  &.rightEdgeUnderScroll .cell:last-child::before {
    content: "";
    position: absolute;
    top: 0;
    right: 100%;
    height: 100%;
    width: component-token("data-grid", "sticky-shadow-size");
    background-image: linear-gradient(
      to left,
      component-token("data-grid", "sticky-shadow-color"),
      transparent
    );
    opacity: component-token("data-grid", "sticky-shadow-opacity");
  }
}

.cell:nth-child(1) {
  position: sticky;
  left: component-token("data-grid", "sticky-left-offset");
  z-index: component-token("data-grid", "cell-stuck-z-index");
}

.columnHeader:nth-child(1) {
  left: component-token("data-grid", "sticky-left-offset");
  z-index: component-token("data-grid", "column-stuck-z-index");
}

.leftEdgeUnderScroll:not(.hasSelection):not(.hasExpansion) .cell:nth-child(1),
.leftEdgeUnderScroll.hasSelection .cell:nth-child(2),
.leftEdgeUnderScroll.hasExpansion .cell:nth-child(2) {
  &::before {
    content: "";
    position: absolute;
    top: 0;
    left: 100%;
    height: 100%;
    width: component-token("data-grid", "sticky-shadow-size");
    background-image: linear-gradient(
      to right,
      component-token("data-grid", "sticky-shadow-color"),
      transparent
    );
    opacity: component-token("data-grid", "sticky-shadow-opacity");
  }
}

.hasSelection,
.hasExpansion {
  .cell:nth-child(1) {
    left: 0;
  }
  .columnHeader:nth-child(1) {
    left: 0;
  }
  .cell:nth-child(2) {
    position: sticky;
    z-index: component-token("data-grid", "cell-stuck-z-index");
  }
  .columnHeader:nth-child(2) {
    z-index: component-token("data-grid", "column-stuck-z-index");
  }
  .columnHeader,
  .cell {
    &:nth-child(1) {
      padding-left: design-token("space.2");
      padding-right: design-token("space.1.5");
    }
    &:nth-child(2) {
      left: 44px;
    }
    & + * {
      padding-left: 0;
    }
  }
}

.contents {
  display: contents;
}

.actionsCellContent {
  display: inline-flex;
  gap: design-token("space.1.5");
}

.topInterceptor,
.rightInterceptor,
.bottomInterceptor,
.leftInterceptor {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}

.topInterceptor,
.bottomInterceptor {
  height: 1px;
}

.leftInterceptor,
.rightInterceptor {
  width: 1px;
}

.topInterceptor {
  bottom: auto;
}

.bottomInterceptor {
  top: auto;
}

.leftInterceptor {
  right: auto;
}

.rightInterceptor {
  left: auto;
}

.rowHovered {
  @include component-token(
    "data-grid",
    "cell-bg",
    design-token("color.gray.050")
  );
  @include component-token(
    "data-grid",
    "cell-text",
    design-token("color.blue.700")
  );
}

.sortIndicatorSorted {
  @include component-token(
    "data-grid",
    "sort-icon-color",
    design-token("color.white")
  );
}

.headerSecondary {
  @include component-token(
    "data-grid",
    "header-bg",
    design-token("color.gray.050")
  );
  @include component-token(
    "data-grid",
    "header-text",
    design-token("color.blue.800")
  );
  @include component-token(
    "data-grid",
    "sort-icon-color",
    design-token("color.gray.400")
  );
  .sortIndicatorSorted {
    @include component-token(
      "data-grid",
      "sort-icon-color",
      design-token("color.blue.800")
    );
  }
}
